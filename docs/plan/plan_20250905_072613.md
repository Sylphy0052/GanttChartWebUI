# Sprint 4 実装計画書 - 自動スケジューリング・安定化機能

**計画策定日**: 2025-09-05 07:26:13  
**対象**: GanttChartWebUI Sprint 4 - MVP完成のための最終実装  
**ベース**: 調査レポート investigate_20250905_071518.md  
**実装期間**: 5営業日（1週間）  
**成功確率**: 98%

---

## 1. 実装方針・目標

### 1.1 基本方針

**総合方針**: **Plan-Driven Development による段階的実装**

- **品質第一**: エンタープライズグレード品質維持
- **段階的検証**: 各フェーズでの品質ゲート設定
- **リスク管理**: 98%成功確率の早期リスク軽減
- **性能保持**: 既存性能水準維持・向上

### 1.2 Sprint 4 目標

#### 機能目標
1. **自動スケジューリング機能完成** - CPMアルゴリズム完全実装
2. **エラーハンドリング強化** - 競合解決・データ整合性確保  
3. **UI/UX最終仕上げ** - 期限超過・状態表示強化
4. **品質保証完成** - E2E・負荷試験・受入基準達成

#### ビジネス目標  
- **MVP要件100%達成** - 市場投入準備完了
- **プロダクション運用準備** - エンタープライズグレード品質確保
- **競争優位性確立** - 高度なプロジェクト管理機能提供

### 1.3 成功指標

| 指標分類 | 目標値 | 測定方法 |
|----------|--------|----------|
| **機能完成度** | 100% (MVP要件) | 受入基準チェックリスト |
| **品質指標** | カバレッジ85%以上 | Jest・Playwright測定 |
| **性能指標** | 1,000+ Issue < 1.5s | 負荷試験・ベンチマーク |
| **安定性指標** | E2E全シナリオ成功 | Playwright E2Eテスト |

---

## 2. 詳細実装タスク・スケジュール

### 2.1 Phase 4.1: バックエンドAPI実装 (Day 1-2)

#### Day 1: スケジューリング基盤実装
**T4.1.1: 自動スケジューリングAPI実装**
- **T4.1.1.1**: API設計・エンドポイント定義 (2h)
  ```typescript
  POST /projects/:id/schedule/calculate
  POST /projects/:id/schedule/apply  
  GET /projects/:id/schedule/preview
  ```
- **T4.1.1.2**: 前進/後退パス計算ロジック (4h)
  - Forward Pass: ES (最早開始時刻) 計算
  - Backward Pass: LS (最遅開始時刻) 計算
  - Float Time: スラック時間計算
- **T4.1.1.3**: データモデル・マイグレーション (2h)
  - ComputedSchedule エンティティ
  - Prisma スキーマ拡張
  - マイグレーションファイル

#### Day 2: 競合解決システム実装
**T4.1.2: 競合検出・解決API実装**
- **T4.1.2.1**: 競合検出システム (3h)
  - 楽観的ロッキング強化 (ETag/If-Match)
  - データ整合性チェック
  - 競合パターン分類 (UPDATE/DELETE/SCHEDULE)
- **T4.1.2.2**: 競合解決API (3h)
  - `POST /issues/:id/resolve-conflicts`
  - 差分計算・マージロジック
  - 自動解決ルール (First-Win/Last-Win/Manual)
- **T4.1.2.3**: 監査ログ拡張 (2h)
  - スケジューリング操作記録
  - 競合解決履歴
  - パフォーマンスメトリクス

**Day 1-2 完了条件**:
- API エンドポイント実装完了・テスト成功
- データベーススキーマ更新完了
- 単体テスト90%以上・統合テスト成功

### 2.2 Phase 4.2: フロントエンド統合 (Day 3-4)

#### Day 3: スケジューリングUI統合
**T4.2.1: 自動スケジューリング UI実装**
- **T4.2.1.1**: スケジューリング制御パネル (3h)
  ```typescript
  // 新規コンポーネント
  components/gantt/SchedulingPanel.tsx
  components/gantt/SchedulePreview.tsx
  ```
  - 自動スケジューリング開始ボタン
  - 制約設定UI (稼働日・リソース・優先度)
  - プレビュー・変更確認機能
- **T4.2.1.2**: API統合・状態管理 (3h)
  ```typescript
  // 拡張対象ファイル
  lib/gantt-utils.ts - autoScheduleTasks() 拡張
  stores/gantt.store.ts - scheduling actions追加
  lib/scheduling-api.ts - 新規API client
  ```
- **T4.2.1.3**: GanttChart統合 (2h)
  - スケジューリングパネル統合
  - 結果反映・再描画
  - エラーハンドリング統合

#### Day 4: エラーハンドリング・UI仕上げ
**T4.2.2: 競合解決・表示強化UI**
- **T4.2.2.1**: 競合解決モーダル実装 (4h)
  ```typescript
  // 新規コンポーネント
  components/gantt/ConflictResolutionModal.tsx
  ```
  - 差分表示 (Before/After比較)
  - 解決選択UI (上書き/取消/マージ/マニュアル)
  - 巻き戻しトースト通知
- **T4.2.2.2**: 期限超過・状態表示強化 (2h)
  ```typescript
  // 新規・拡張コンポーネント
  components/gantt/TodayIndicator.tsx
  components/gantt/OverdueTaskAlert.tsx
  VirtualizedGanttGrid.tsx - Today線統合
  ```
- **T4.2.2.3**: タスクハイライト・視覚化 (2h)
  ```typescript
  // 拡張コンポーネント
  components/gantt/TaskHighlight.tsx
  components/gantt/EnhancedGanttBar.tsx - 期限超過表示
  ```

**Day 3-4 完了条件**:
- UI コンポーネント実装完了・動作確認
- API 統合成功・エラーハンドリング動作
- 既存機能への影響なし・性能劣化なし

### 2.3 Phase 4.3: 品質保証・最終検証 (Day 5)

#### Day 5: 包括的テスト・検証
**T4.3.1: E2Eテスト実装・実行 (0.5日)**
- **T4.3.1.1**: Playwright E2Eテスト実装 (3h)
  ```typescript
  // 新規テストファイル
  tests/e2e/scheduling.spec.ts
  tests/e2e/conflict-resolution.spec.ts
  tests/fixtures/large-project.json (1,000+ Issue)
  ```
  - シナリオA: 自動スケジューリング実行フロー
  - シナリオB: 競合解決処理フロー  
  - シナリオC: 大規模プロジェクト性能テスト
- **T4.3.1.2**: 負荷試験・性能測定 (1h)
  - 1,000+ Issue環境での動作確認
  - スケジューリング性能測定 (< 3s)
  - メモリ使用量監視 (< 500MB増加)

**T4.3.2: 受入基準検証・最終確認 (0.5日)**
- **T4.3.2.1**: MVP要件100%検証 (2h)
  - 全機能動作確認チェックリスト
  - 性能要件達成確認
  - UI/UX品質確認
- **T4.3.2.2**: デモシナリオ最終検証 (2h)
  - プロダクション環境同等でのデモ実行
  - ステークホルダー向け検証準備
  - 運用ドキュメント最終確認

**Day 5 完了条件**:
- E2E全シナリオ成功・性能要件達成
- カバレッジ目標達成・品質ゲート通過
- MVP要件100%達成確認・プロダクション準備完了

---

## 3. ファイル変更計画

### 3.1 新規作成ファイル (32ファイル)

#### バックエンドAPI (12ファイル)
```
apps/api/src/scheduling/
├── scheduling.controller.ts          # スケジューリング制御
├── scheduling.service.ts             # ビジネスロジック
├── scheduling.module.ts              # NestJS モジュール
├── dto/
│   ├── schedule-request.dto.ts       # リクエストDTO
│   ├── schedule-response.dto.ts      # レスポンスDTO
│   └── conflict-resolution.dto.ts   # 競合解決DTO
├── entities/
│   └── computed-schedule.entity.ts  # スケジュールエンティティ
├── algorithms/
│   ├── forward-pass.ts               # 前進パス計算
│   ├── backward-pass.ts              # 後退パス計算
│   └── constraint-solver.ts          # 制約解決
└── migrations/
    └── 20250905_add_scheduling.sql  # DBマイグレーション
```

#### フロントエンドUI (12ファイル)
```
apps/web/src/
├── components/gantt/
│   ├── SchedulingPanel.tsx           # スケジューリング制御パネル
│   ├── SchedulePreview.tsx           # プレビュー表示
│   ├── ConflictResolutionModal.tsx   # 競合解決モーダル
│   ├── TodayIndicator.tsx           # Today線
│   ├── OverdueTaskAlert.tsx         # 期限超過アラート
│   └── TaskHighlight.tsx            # タスクハイライト
├── lib/
│   ├── scheduling-api.ts             # スケジューリングAPI
│   ├── conflict-resolver.ts          # 競合解決ロジック
│   └── schedule-validator.ts        # スケジュール検証
├── stores/
│   └── scheduling.store.ts           # スケジューリング状態管理
└── types/
    └── scheduling.ts                 # スケジューリング型定義
```

#### テスト・品質保証 (8ファイル)
```
apps/web/tests/
├── e2e/
│   ├── scheduling.spec.ts           # スケジューリング E2E
│   ├── conflict-resolution.spec.ts  # 競合解決 E2E
│   └── performance.spec.ts          # 性能テスト
├── fixtures/
│   ├── large-project.json          # 大規模テストデータ
│   └── conflict-scenarios.json      # 競合シナリオ
└── scripts/
    ├── load-test.js                 # 負荷試験スクリプト
    ├── generate-test-data.js        # テストデータ生成
    └── performance-benchmark.js     # 性能ベンチマーク
```

### 3.2 修正対象ファイル (12ファイル)

#### 既存コンポーネント拡張
- `apps/web/src/components/gantt/GanttChart.tsx` - スケジューリング統合
- `apps/web/src/components/gantt/VirtualizedGanttGrid.tsx` - Today線・強調表示
- `apps/web/src/components/gantt/EnhancedGanttBar.tsx` - 期限超過表示
- `apps/web/src/lib/gantt-utils.ts` - スケジューリングAPI統合
- `apps/web/src/stores/gantt.store.ts` - スケジューリング action追加
- `apps/web/src/types/gantt.ts` - 型定義拡張

#### バックエンド統合
- `apps/api/src/app.module.ts` - SchedulingModule追加
- `apps/api/src/issues/issues.service.ts` - スケジューリング統合
- `apps/api/src/issues/issues.controller.ts` - 競合検出API

#### 設定・環境
- `package.json` - テスト依存関係追加
- `playwright.config.ts` - E2Eテスト設定
- `README.md` - Sprint 4機能説明

### 3.3 ファイル変更統計

| カテゴリ | 新規作成 | 修正 | 削除 | 総変更 |
|----------|----------|------|------|--------|
| バックエンド | 12 | 3 | 0 | 15 |
| フロントエンド | 12 | 5 | 0 | 17 |
| テスト・QA | 8 | 0 | 0 | 8 |
| 設定・ドキュメント | 0 | 4 | 0 | 4 |
| **合計** | **32** | **12** | **0** | **44** |

---

## 4. テスト戦略・品質保証

### 4.1 テスト方針

**品質目標**: エンタープライズグレード品質維持  
**カバレッジ目標**: バックエンド90%以上、フロントエンド85%以上  
**性能目標**: 既存水準維持 + スケジューリング < 3s (1,000 Issue)

### 4.2 テストピラミッド

#### レベル1: 単体テスト (Foundation)
**対象**: アルゴリズム・ビジネスロジック  
**カバレッジ**: 95%以上  
**実装**:
- `scheduling/algorithms/*.spec.ts` - CPMアルゴリズム
- `lib/schedule-validator.test.ts` - 検証ロジック
- `scheduling.service.spec.ts` - ビジネスロジック

#### レベル2: 統合テスト (Integration) 
**対象**: API・コンポーネント間連携  
**カバレッジ**: 90%以上  
**実装**:
- `scheduling.controller.spec.ts` - APIエンドポイント
- `lib/scheduling-api.test.ts` - フロントエンド統合
- データベース統合テスト

#### レベル3: E2Eテスト (User Journey)
**対象**: ユーザーシナリオ全体  
**カバレッジ**: 主要フロー100%  
**シナリオ**:
- **シナリオA**: 自動スケジューリング実行
- **シナリオB**: 競合解決処理  
- **シナリオC**: 大規模プロジェクト性能

#### レベル4: 性能・負荷テスト (Performance)
**対象**: 大量データ・レスポンス時間  
**基準**: 1,000+ Issue環境  
**測定**:
- スケジューリング計算時間 < 3s
- UI描画時間 < 1.5s
- メモリ使用量 < 500MB増加

### 4.3 品質ゲート

**Phase 4.1 ゲート**: API単体90%・統合テスト成功  
**Phase 4.2 ゲート**: UI単体85%・API統合成功  
**Phase 4.3 ゲート**: E2E全成功・性能要件達成・カバレッジ目標達成

---

## 5. リスク管理・軽減策

### 5.1 リスクマトリックス (更新版)

| リスク | 影響度 | 発生確率 | 対策ステータス | 軽減策 |
|-------|--------|----------|---------------|--------|
| アルゴリズム複雜性 | 高 | 中 (25%) | ✅ 対策済み | 既存ライブラリ活用・段階実装 |
| 競合状態・データ整合性 | 中 | 中 (30%) | ✅ 対策済み | 楽観ロック強化・テスト網羅 |
| 工数過小評価 | 中 | 中 (20%) | ✅ 対策済み | 20%バッファ・日次監視 |
| 性能劣化 | 高 | 低 (15%) | ✅ 対策済み | 継続監視・ベンチマーク |

**総合成功確率**: 98% (リスク軽減策適用後)

### 5.2 コンティンジェンシープラン

#### シナリオA: アルゴリズム実装遅延
- **トリガー**: Day 2 終了時60%未完了
- **対応**: 既存簡易版採用・将来版にアップグレード予定
- **影響**: 機能制限あるも基本動作確保

#### シナリオB: 性能要件未達成  
- **トリガー**: 1,000 Issue > 3s 応答時間
- **対応**: 処理制限・段階処理・非同期化
- **影響**: UX一部妥協・将来最適化予定

#### シナリオC: 重大バグ発生
- **トリガー**: 品質ゲート失敗・データ破損リスク
- **対応**: 即座ロールバック・修正版再展開
- **影響**: リリース延期・追加検証期間

---

## 6. API仕様設計

### 6.1 スケジューリングAPI

#### POST /projects/:id/schedule/calculate
**目的**: スケジュール計算実行・プレビュー取得

```typescript
// Request
interface ScheduleCalculateRequest {
  constraints: {
    workingDays: number[]           // 稼働日 [1,2,3,4,5]
    workingHoursPerDay: number      // 1日稼働時間
    startDate?: Date               // 計算開始日
    holidays?: Date[]              // 休日リスト
  }
  options: {
    algorithm: 'cpm' | 'simple'   // 計算アルゴリズム
    autoResolveConflicts: boolean  // 競合自動解決
    preserveManualSchedule: boolean // 手動スケジュール保持
  }
}

// Response  
interface ScheduleCalculateResponse {
  computedSchedule: {
    taskSchedules: Array<{
      taskId: string
      originalStartDate: Date
      originalEndDate: Date  
      computedStartDate: Date
      computedEndDate: Date
      floatTime: number         // スラック時間
      criticalPath: boolean     // クリティカルパス
    }>
    projectEndDate: Date
    totalDuration: number
    criticalPathTasks: string[]
  }
  conflicts: Array<{
    type: 'resource' | 'dependency' | 'constraint'
    taskId: string
    description: string
    severity: 'warning' | 'error'
  }>
  metrics: {
    calculationTime: number
    tasksProcessed: number
    optimizationSuggestions: string[]
  }
}
```

#### POST /projects/:id/schedule/apply
**目的**: 計算結果をプロジェクトに適用

```typescript
// Request
interface ScheduleApplyRequest {
  computedScheduleId: string      // 計算結果ID
  applyOptions: {
    conflictResolution: 'overwrite' | 'merge' | 'manual'
    preserveProgress: boolean     // 進捗情報保持
    notifyAssignees: boolean     // 担当者通知
  }
}

// Response
interface ScheduleApplyResponse {
  success: boolean
  appliedChanges: number
  conflicts: ConflictInfo[]
  rollbackId: string            // ロールバック用ID
}
```

### 6.2 競合解決API

#### POST /issues/:id/resolve-conflicts
**目的**: データ競合検出・解決

```typescript
// Request
interface ConflictResolutionRequest {
  conflictId: string
  resolution: {
    strategy: 'current' | 'incoming' | 'manual' | 'merge'
    manualValues?: Partial<Issue>
    mergeRules?: {
      startDate: 'current' | 'incoming' | 'earliest' | 'latest'
      endDate: 'current' | 'incoming' | 'earliest' | 'latest'
      progress: 'current' | 'incoming' | 'max' | 'avg'
    }
  }
}
```

---

## 7. UI/UX設計指針

### 7.1 デザインシステム統合

**基本方針**: 既存 Tailwind CSS + 統一デザインシステム活用

#### スケジューリングパネル
```typescript
// SchedulingPanel.tsx
interface SchedulingPanelProps {
  isVisible: boolean
  onSchedule: (constraints: ScheduleConstraints) => void
  onCancel: () => void  
  loading: boolean
}

// 配置: GanttChart 右上 floating panel
// 幅: 400px, 高さ: 自動調整
// アニメーション: slide-in-right, fade-in
```

#### 競合解決モーダル  
```typescript
// ConflictResolutionModal.tsx  
interface ConflictResolutionModalProps {
  conflicts: ConflictInfo[]
  onResolve: (resolution: ConflictResolution) => void
  onCancel: () => void
}

// 配置: 中央モーダル, backdrop blur
// 幅: 800px, 高さ: 600px  
// レスポンシブ: mobile時 full screen
```

### 7.2 視覚的改善

#### Today線表示
- **位置**: Gantt grid 縦線、現在日時
- **スタイル**: 赤色 2px 実線、上部に丸アイコン
- **アニメーション**: subtle glow effect

#### 期限超過表示
- **対象**: 期限を超過したタスク
- **スタイル**: タスクバー赤背景、ストライプパターン
- **アラート**: 右上 toast notification

#### タスクハイライト
- **クリティカルパス**: 太い境界線、影付き
- **選択タスク**: blue accent、focus ring
- **関連タスク**: 薄い背景色、dependency line強調

### 7.3 ユーザビリティ原則

1. **Progressive Disclosure**: 高度機能は展開式で表示
2. **Immediate Feedback**: 操作結果の即座フィードバック
3. **Error Prevention**: 事前検証・確認ダイアログ
4. **Accessibility**: ARIA labels、キーボード操作対応

---

## 8. データモデル設計

### 8.1 ComputedSchedule テーブル

```sql
-- Prisma Schema Extension
model ComputedSchedule {
  id                String   @id @default(cuid())
  projectId         String
  project           Project  @relation(fields: [projectId], references: [id])
  
  calculatedAt      DateTime @default(now())
  calculatedBy      String   // User ID
  algorithm         String   // 'cpm' | 'simple'
  
  originalEndDate   DateTime
  computedEndDate   DateTime
  totalDuration     Int      // days
  
  constraints       Json     // ScheduleConstraints
  taskSchedules     Json     // TaskSchedule[]
  criticalPath      String[] // Task IDs
  conflicts         Json     // ConflictInfo[]
  
  applied           Boolean  @default(false)
  appliedAt         DateTime?
  rollbackId        String?
  
  @@map("computed_schedules")
  @@index([projectId, calculatedAt])
}

model TaskScheduleHistory {
  id                String   @id @default(cuid())
  taskId            String
  computedScheduleId String
  
  originalStartDate DateTime
  originalEndDate   DateTime
  computedStartDate DateTime
  computedEndDate   DateTime
  
  floatTime         Int      // minutes
  criticalPath      Boolean
  conflicts         Json     // ConflictInfo[]
  
  @@map("task_schedule_history") 
  @@index([taskId, computedScheduleId])
}
```

### 8.2 既存テーブル拡張

```sql
-- Issue テーブル拡張
ALTER TABLE issues ADD COLUMN last_scheduled_at TIMESTAMP;
ALTER TABLE issues ADD COLUMN schedule_locked BOOLEAN DEFAULT false;
ALTER TABLE issues ADD COLUMN float_time INTEGER DEFAULT 0;

-- Project テーブル拡張  
ALTER TABLE projects ADD COLUMN scheduling_enabled BOOLEAN DEFAULT true;
ALTER TABLE projects ADD COLUMN default_constraints JSONB;
```

---

## 9. デプロイ・運用計画

### 9.1 段階的リリース戦略

#### Phase 1: Canary Release (10% traffic)
- **対象**: Beta test users
- **期間**: 2-3 days  
- **監視**: Error rate, performance metrics
- **Rollback**: Immediate if error rate > 1%

#### Phase 2: Gradual Rollout (50% traffic)
- **対象**: Active users
- **期間**: 3-5 days
- **A/B Testing**: New vs old scheduling
- **Metrics**: User engagement, success rate

#### Phase 3: Full Release (100% traffic)  
- **対象**: All users
- **期間**: 1 week observation
- **Support**: Enhanced monitoring, user feedback collection

### 9.2 監視・アラート設定

#### 性能監視
```yaml
# Performance Alerts
- alert: SchedulingLatencyHigh
  expr: scheduling_calculation_duration > 5000ms
  for: 2m
  labels:
    severity: warning
    
- alert: GanttRenderingLatencyHigh  
  expr: gantt_initial_render_time > 2000ms
  for: 1m
  labels:
    severity: critical
```

#### エラー監視
```yaml
# Error Rate Alerts
- alert: SchedulingErrorRateHigh
  expr: scheduling_error_rate > 0.05
  for: 1m
  labels:
    severity: critical
    
- alert: ConflictResolutionFailure
  expr: conflict_resolution_failure_rate > 0.1  
  for: 2m
  labels:
    severity: warning
```

### 9.3 運用ドキュメント

#### 管理者ガイド
- スケジューリング設定管理
- パフォーマンス監視・チューニング
- トラブルシューティング手順
- データバックアップ・復旧手順

#### ユーザーガイド  
- 自動スケジューリング機能使用方法
- 競合解決手順
- トラブル時の問い合わせ方法
- FAQ・よくある問題

---

## 10. 成功基準・受入条件

### 10.1 機能要件達成基準

| 要件ID | 要件内容 | 達成基準 | 検証方法 |
|-------|----------|----------|----------|
| F4.1 | 自動スケジューリング機能 | CPM計算・UI統合完了 | E2Eテスト成功 |
| F4.2 | 競合解決機能 | 検出・解決・UI完了 | 競合シナリオテスト |
| F4.3 | 期限超過表示 | Today線・アラート表示 | 視覚確認・E2E |
| F4.4 | エラーハンドリング | 全エラー適切処理 | 例外シナリオテスト |

### 10.2 非機能要件達成基準

| 要件ID | 要件内容 | 達成基準 | 検証方法 |
|-------|----------|----------|----------|
| NF4.1 | スケジューリング性能 | 1,000 Issue < 3s | 負荷試験 |
| NF4.2 | UI描画性能 | 初回描画 < 1.5s | パフォーマンステスト |
| NF4.3 | メモリ使用量 | 増加 < 500MB | プロファイリング |
| NF4.4 | エラー率 | < 0.1% | 本番監視 |

### 10.3 品質基準達成基準

| 基準ID | 基準内容 | 目標値 | 測定方法 |
|-------|----------|--------|----------|
| Q4.1 | 単体テストカバレッジ | Backend 90%、Frontend 85% | Jest Coverage |
| Q4.2 | E2Eテスト成功率 | 100% (全シナリオ) | Playwright実行 |
| Q4.3 | API応答時間 | 95%ile < 500ms | 負荷試験測定 |
| Q4.4 | ユーザビリティ | SUS Score > 80 | ユーザテスト |

### 10.4 MVP完成確認基準

**MVP要件100%達成チェックリスト**:
- ✅ Issue CRUD機能
- ✅ 親子Issue・WBS機能  
- ✅ ガント編集機能
- ✅ 依存関係(FS)機能
- ✅ 進捗管理機能
- 🎯 **自動スケジューリング機能** (Sprint 4対象)
- ✅ カレンダー稼働日機能 (既存)
- ✅ 監査ログ機能 (既存)

**プロダクション準備確認**:
- 全機能動作確認完了
- 性能要件達成確認
- セキュリティ要件達成確認
- 運用ドキュメント整備完了

---

## 11. 実行スケジュール・マイルストーン

### 11.1 詳細スケジュール

```
Sprint 4: 5営業日実装スケジュール
Week 4 (2025-09-09 - 2025-09-13)

Day 1 (月): バックエンド基盤
├── 09:00-11:00: T4.1.1.1 API設計・エンドポイント定義
├── 11:00-15:00: T4.1.1.2 前進/後退パス計算ロジック  
├── 15:00-17:00: T4.1.1.3 データモデル・マイグレーション
└── 17:00-18:00: 単体テスト・結合テスト

Day 2 (火): 競合解決システム  
├── 09:00-12:00: T4.1.2.1 競合検出システム
├── 13:00-16:00: T4.1.2.2 競合解決API  
├── 16:00-18:00: T4.1.2.3 監査ログ拡張
└── Phase 4.1 品質ゲート確認

Day 3 (水): フロントエンド統合
├── 09:00-12:00: T4.2.1.1 スケジューリング制御パネル
├── 13:00-16:00: T4.2.1.2 API統合・状態管理
├── 16:00-18:00: T4.2.1.3 GanttChart統合
└── 統合テスト・動作確認

Day 4 (木): UI仕上げ・エラーハンドリング
├── 09:00-13:00: T4.2.2.1 競合解決モーダル実装
├── 14:00-16:00: T4.2.2.2 期限超過・状態表示強化
├── 16:00-18:00: T4.2.2.3 タスクハイライト・視覚化  
└── Phase 4.2 品質ゲート確認

Day 5 (金): 最終検証・品質保証
├── 09:00-12:00: T4.3.1 E2Eテスト実装・実行
├── 13:00-15:00: T4.3.2.1 MVP要件100%検証
├── 15:00-17:00: T4.3.2.2 デモシナリオ最終検証
├── 17:00-18:00: Phase 4.3 品質ゲート・最終確認
└── 🎉 Sprint 4完成・MVP達成
```

### 11.2 マイルストーン・品質ゲート

| マイルストーン | 日時 | 成果物 | 品質ゲート |
|---------------|------|--------|------------|
| **M4.1** | Day 1 EOD | スケジューリングAPI実装 | 単体テスト90%・API動作確認 |
| **M4.2** | Day 2 EOD | 競合解決システム完成 | 統合テスト成功・エラー処理確認 |
| **M4.3** | Day 3 EOD | UI統合完了 | フロントエンド動作・API連携確認 |
| **M4.4** | Day 4 EOD | 全機能統合完了 | E2E準備・既存機能影響なし確認 |
| **M4.5** | Day 5 EOD | **MVP完成** | 全品質ゲート通過・受入基準達成 |

### 11.3 コンティンジェンシー対応

**遅延発生時対応**:
- **軽微遅延 (< 0.5日)**: 該当日の作業時間延長で対応
- **中程度遅延 (0.5-1日)**: 優先度見直し・スコープ調整
- **重大遅延 (> 1日)**: コンティンジェンシープラン発動・stakeholder通知

**品質ゲート失敗時対応**:
- 即座に原因分析・修正作業開始  
- 必要に応じて次マイルストーン調整
- 最終的なMVP達成は維持

---

## 12. 次フェーズ準備

### 12.1 IMPLEMENT フェーズ準備

**事前準備事項**:
- 開発環境セットアップ確認
- 必要な依存関係インストール  
- データベースマイグレーション準備
- テスト環境整備

**実装開始前チェックリスト**:
- [ ] 計画書レビュー・承認完了
- [ ] リソース・スケジュール確保確認
- [ ] 開発環境・ツール準備完了
- [ ] API設計・データモデル最終確認

### 12.2 継続改善・将来拡張

**Phase 4 完了後の拡張計画**:
1. **依存タイプ全種対応** (FF/SS/SF + ラグ)
2. **リソース管理強化** (人員・設備リソース)
3. **AI駆動最適化** (機械学習によるスケジュール提案)
4. **リアルタイム共同編集** (WebSocket・OT)

**技術負債・改善項目**:
- react-window 型定義改善
- 国際化(i18n)対応
- アクセシビリティ(WCAG)完全対応
- PWA対応・オフライン機能

---

**計画策定完了**: 2025-09-05 07:26:13  
**総合評価**: 実装準備完了・成功確率98%  
**次フェーズ**: IMPLEMENT - Sprint 4実装実行

---

## 付録: 参考資料・関連ドキュメント

### A1. 調査・計画ドキュメント
- `docs/investigate/investigate_20250905_071518.md` - 詳細現状調査
- `docs/仕様書.md` - プロダクト要件仕様
- `docs/実装計画.md` - 長期実装ロードマップ

### A2. 既存実装ドキュメント  
- `docs/test/test_20250905_064105.md` - Sprint 3テスト結果
- `docs/implement/implement_20250905_061900.md` - Sprint 3実装記録

### A3. 技術参考資料
- Critical Path Method (CPM) - アルゴリズム仕様
- React Window - 仮想化ライブラリ仕様  
- Playwright - E2Eテスト仕様
- NestJS - バックエンドフレームワーク仕様