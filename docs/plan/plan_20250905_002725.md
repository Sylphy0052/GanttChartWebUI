# PoC実装プラン (Week 1: Issue CRUD)

## プラン策定日時
2025-09-05 00:27:25

## 実装対象・スコープ
- **対象**: Week 1 - Issue CRUD機能 + 基本認証
- **期間**: 1週間（推定40時間）
- **目標**: 基本的なIssue管理機能の動作する最小実装

## 実装方針

### アーキテクチャ方針
- **Backend**: NestJS + Prisma ORM + PostgreSQL
- **Frontend**: Next.js 14 (App Router) + React 18 + TypeScript
- **認証**: JWT + Passport.js
- **状態管理**: Zustand (クライアント) + React Query (サーバー状態)
- **スタイリング**: Tailwind CSS

### 実装アプローチ
1. **Backend-First開発**: API実装 → Frontend実装
2. **段階的構築**: 最小機能 → 機能拡張
3. **型安全性優先**: TypeScript strict mode活用
4. **テスト駆動開発**: 主要機能にテスト実装

## 詳細実装タスク

### Phase 1: Backend基盤 (優先度: 最高)

#### 1.1 NestJSアプリケーション基盤
- **優先度**: P0 (必須)
- **工数**: 4時間
- **成果物**:
  - `src/main.ts` - アプリケーションエントリーポイント
  - `src/app.module.ts` - ルートモジュール
  - `src/app.controller.ts` - ヘルスチェックAPI
  - 基本的なミドルウェア設定（CORS、ログ、バリデーション）

#### 1.2 認証基盤
- **優先度**: P0 (必須)
- **工数**: 6時間
- **成果物**:
  - `src/auth/auth.module.ts` - 認証モジュール
  - `src/auth/auth.service.ts` - JWT発行・検証
  - `src/auth/jwt.strategy.ts` - JWT認証戦略
  - `src/auth/guards/jwt.guard.ts` - JWT認証ガード
  - `src/auth/dto/` - 認証関連DTO
- **エンドポイント**:
  - `POST /auth/login` - ログイン（簡易実装）

#### 1.3 Issue CRUD API
- **優先度**: P0 (必須)
- **工数**: 8時間
- **成果物**:
  - `src/issues/issues.module.ts` - Issueモジュール
  - `src/issues/issues.service.ts` - ビジネスロジック
  - `src/issues/issues.controller.ts` - RESTエンドポイント
  - `src/issues/dto/` - Issue関連DTO
  - `src/issues/entities/issue.entity.ts` - Issue エンティティ
- **エンドポイント**:
  - `GET /issues` - Issue一覧（ページング対応）
  - `POST /issues` - Issue作成
  - `GET /issues/:id` - Issue詳細取得
  - `PATCH /issues/:id` - Issue更新
  - `DELETE /issues/:id` - Issue削除（論理削除）

#### 1.4 共通機能
- **優先度**: P1 (高)
- **工数**: 3時間
- **成果物**:
  - `src/common/filters/all-exceptions.filter.ts` - 統一エラーハンドリング
  - `src/common/interceptors/transform.interceptor.ts` - レスポンス変換
  - `src/common/pipes/validation.pipe.ts` - バリデーション
  - `src/prisma/prisma.service.ts` - Prismaクライアント管理

### Phase 2: Frontend基盤 (優先度: 高)

#### 2.1 App Router基盤
- **優先度**: P0 (必須)
- **工数**: 4時間
- **成果物**:
  - `src/app/layout.tsx` - ルートレイアウト
  - `src/app/page.tsx` - ホーム画面
  - `src/app/globals.css` - グローバルスタイル
  - `src/components/ui/` - 基本UIコンポーネント

#### 2.2 認証関連
- **優先度**: P0 (必須)
- **工数**: 5時間
- **成果物**:
  - `src/app/login/page.tsx` - ログイン画面
  - `src/lib/auth.ts` - 認証ユーティリティ
  - `src/stores/auth.store.ts` - 認証状態管理 (Zustand)
  - `src/components/auth/` - 認証関連コンポーネント

#### 2.3 Issue管理UI
- **優先度**: P0 (必須)  
- **工数**: 10時間
- **成果物**:
  - `src/app/issues/page.tsx` - Issue一覧画面
  - `src/app/issues/[id]/page.tsx` - Issue詳細画面
  - `src/app/issues/create/page.tsx` - Issue作成画面
  - `src/components/issues/` - Issue関連コンポーネント
  - `src/lib/api.ts` - APIクライアント
  - `src/stores/issues.store.ts` - Issue状態管理

#### 2.4 共通UI・ユーティリティ
- **優先度**: P1 (高)
- **工数**: 3時間
- **成果物**:
  - `src/components/common/` - 共通UIコンポーネント
  - `src/lib/utils.ts` - ユーティリティ関数
  - `src/hooks/` - カスタムフック

## ファイル変更計画

### 新規作成ファイル

#### Backend (apps/api/)
```
src/
├── main.ts
├── app.module.ts
├── app.controller.ts
├── app.service.ts
├── auth/
│   ├── auth.module.ts
│   ├── auth.service.ts
│   ├── auth.controller.ts
│   ├── jwt.strategy.ts
│   ├── guards/jwt.guard.ts
│   └── dto/login.dto.ts
├── issues/
│   ├── issues.module.ts
│   ├── issues.service.ts
│   ├── issues.controller.ts
│   ├── entities/issue.entity.ts
│   └── dto/
│       ├── create-issue.dto.ts
│       └── update-issue.dto.ts
├── common/
│   ├── filters/all-exceptions.filter.ts
│   ├── interceptors/transform.interceptor.ts
│   └── pipes/validation.pipe.ts
└── prisma/
    └── prisma.service.ts
```

#### Frontend (apps/web/)
```
src/
├── app/
│   ├── layout.tsx
│   ├── page.tsx
│   ├── globals.css
│   ├── login/
│   │   └── page.tsx
│   └── issues/
│       ├── page.tsx
│       ├── create/
│       │   └── page.tsx
│       └── [id]/
│           └── page.tsx
├── components/
│   ├── ui/
│   │   ├── button.tsx
│   │   ├── input.tsx
│   │   ├── table.tsx
│   │   └── form.tsx
│   ├── auth/
│   │   ├── login-form.tsx
│   │   └── auth-guard.tsx
│   ├── issues/
│   │   ├── issue-list.tsx
│   │   ├── issue-form.tsx
│   │   └── issue-detail.tsx
│   └── common/
│       ├── header.tsx
│       ├── navigation.tsx
│       └── loading.tsx
├── lib/
│   ├── api.ts
│   ├── auth.ts
│   └── utils.ts
├── stores/
│   ├── auth.store.ts
│   └── issues.store.ts
├── hooks/
│   ├── use-auth.ts
│   └── use-issues.ts
└── types/
    ├── auth.ts
    └── issue.ts
```

### 修正ファイル
- `apps/api/.env` - 環境変数追加
- `apps/web/.env.local` - フロントエンド設定追加

## テスト戦略

### 1. エンドポイントテスト (優先度: 高)
- **対象**: Issue CRUD API全エンドポイント
- **ツール**: Jest + Supertest
- **カバレッジ**: 認証、バリデーション、エラーハンドリング
- **ファイル**: 
  - `test/auth.e2e-spec.ts`
  - `test/issues.e2e-spec.ts`

### 2. 統合テスト (優先度: 中)
- **対象**: 認証 + Issue API連携
- **ツール**: Jest + Test DB
- **カバレッジ**: JWT認証フロー、権限チェック

### 3. E2Eテスト (優先度: 中)
- **対象**: Issue CRUD基本フロー
- **ツール**: Playwright
- **シナリオ**:
  1. ログイン → Issue一覧表示
  2. Issue作成 → 詳細表示
  3. Issue編集 → 更新確認
- **ファイル**: `tests/e2e/issue-crud.spec.ts`

### 4. 単体テスト (優先度: 低)
- **対象**: ビジネスロジック（Service層）
- **ツール**: Jest
- **カバレッジ**: Issue作成・更新・削除ロジック

### 5. パフォーマンステスト (優先度: 低)
- **対象**: Issue一覧取得（1,000件）
- **目標**: 応答時間 < 1.5s
- **ツール**: 手動計測（Week 4で本格実装）

## リスク分析と対策

### 技術リスク

#### 中リスク: JWT認証実装の複雑さ
- **影響**: 認証フローの不具合、セキュリティホール
- **対策**: 
  - NestJS Passportの標準パターンを使用
  - シンプルなJWT設定から開始
  - セキュリティベストプラクティスに従う
- **軽減策**: 段階的な認証機能実装

#### 低リスク: TypeScript strict modeでの型エラー
- **影響**: コンパイルエラー、開発効率低下  
- **対策**: 
  - 継続的な型チェック実行
  - 段階的な型定義整備
- **軽減策**: any型の一時的な使用を許可

### スケジュールリスク

#### 中リスク: Issue CRUD UIの複雑さ
- **影響**: フロントエンド実装の遅延
- **対策**:
  - シンプルなTable UIから開始
  - 段階的な機能拡張
  - UIライブラリ（Radix UI）の活用検討
- **軽減策**: 最小機能での先行実装

#### 中リスク: 認証フローの統合
- **影響**: フロント・バック連携の遅延
- **対策**:
  - バックエンド先行実装
  - フロントエンドは仮認証から開始
  -段階的な認証統合
- **軽減策**: Mock認証での並行開発

### 品質リスク

#### 中リスク: バリデーションの不備
- **影響**: データ整合性の問題、セキュリティリスク
- **対策**:
  - class-validatorによる厳密なバリデーション
  - フロント・バック両側でのバリデーション実装
- **軽減策**: 段階的なバリデーション強化

#### 中リスク: エラーハンドリングの不備  
- **影響**: ユーザビリティ低下、デバッグ困難
- **対策**:
  - 統一的なエラーレスポンス設計
  - 適切なHTTPステータスコード使用
  - フロントエンドでの丁寧なエラー表示
- **軽減策**: エラーログの充実

## 実装順序とマイルストーン

### Day 1-2: Backend基盤 (16時間)
1. NestJSアプリケーション基盤構築
2. 認証モジュール実装
3. Issue CRUD API実装（基本機能）
4. 統一エラーハンドリング実装

**完了基準**: 
- 全APIエンドポイントが正常動作
- JWT認証が機能
- Swagger文書が自動生成

### Day 3-4: Frontend基盤 (16時間)
1. App Router基盤構築  
2. 認証画面・機能実装
3. Issue一覧画面実装
4. Issue詳細・編集画面実装

**完了基準**:
- 認証フローが完動
- Issue CRUD操作がUI上で実行可能
- レスポンシブ対応完了

### Day 5: テスト・仕上げ (8時間)
1. エンドポイントテスト実装
2. E2Eテスト基本シナリオ実装
3. バグ修正・安定化
4. デプロイテスト

**完了基準**:
- 主要テストが緑色
- 1,000件データでの動作確認完了
- docker-compose環境での動作確認

## 成功基準

### 機能的成功基準
- [ ] JWT認証によるログイン・ログアウト
- [ ] Issue作成・一覧・詳細・編集・削除の全CRUD操作
- [ ] 1,000件のIssueデータでの正常動作  
- [ ] レスポンシブなUI（モバイル対応）
- [ ] 基本的なエラーハンドリング

### 非機能的成功基準
- [ ] Issue一覧表示 < 2秒（1,000件データ）
- [ ] CRUD操作応答 < 500ms
- [ ] TypeScript型エラーなし
- [ ] 主要APIのテストカバレッジ > 80%

### 技術的成功基準
- [ ] Docker Compose環境での起動成功
- [ ] CI/CDパイプライン基本動作
- [ ] Swagger API文書の自動生成
- [ ] 本番環境へのデプロイ可能性確認

## 次フェーズへの引き継ぎ事項

### Week 2準備事項
1. **WBS階層表示設計**: 親子関係UI設計の詳細検討
2. **ガント表示技術調査**: SVG + D3実装方針の確定
3. **パフォーマンス計測基盤**: 1,000件データでの性能測定環境

### 技術的引き継ぎ
1. **認証機能拡張**: RBAC（Owner/Admin/Viewer）実装準備
2. **API拡張**: WBS、依存関係エンドポイント設計
3. **フロントエンド状態管理**: Zustand設計パターンの標準化

### 検討課題
1. **ドラッグ&ドロップライブラリ**: React DnD vs @dnd-kit選定
2. **仮想化ライブラリ**: react-virtualized vs react-window検討  
3. **UIライブラリ**: Radix UI導入検討

## 補足事項

### 開発環境
- Node.js 20.x
- PostgreSQL 15 (Docker)
- IDE: VS Code (推奨拡張機能リストあり)

### 品質管理
- Pre-commit hooks (lint + type-check)
- 自動フォーマット (Prettier)
- 継続的型チェック (TypeScript strict)

### ドキュメント更新
- API仕様: Swagger自動生成
- E2Eテスト: README更新
- セットアップ手順: DEVELOPMENT.md作成

---

**実装開始準備完了** - 全計画策定完了、実装フェーズ移行可能