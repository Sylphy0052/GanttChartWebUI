# 次の実装項目調査レポート

**調査実行日**: 2025-09-05 03:48:51  
**調査対象**: GanttChartWebUI プロジェクト  
**調査目的**: 仕様書に基づく未実装項目の特定と実装優先度の決定

---

## 1. 調査サマリー

### 主要発見事項
- 基本的なIssue管理・WBS・Gantt機能は**実装完了済み**
- Sprint 3-4で計画されている**高度な機能群が未実装**
- 性能要件（初回描画1.5s、ドラッグ応答100ms）を満たすための**最適化が必要**
- プロジェクト管理の**パスワード保護機能が最優先実装項目**

### 推奨アクション
Sprint 3の計画に従い、**プロジェクトパスワード保護機能**から着手することを推奨。

---

## 2. 現在の実装状況分析

### 2.1 実装完了済み機能

| 機能分野 | 実装状況 | 詳細 |
|---------|---------|------|
| **Issue管理** | ✅ 完了 | CRUD操作、担当者・ステータス・工数管理済み |
| **WBS階層** | ✅ 完了 | 親子階層表示、react-windowによる仮想化済み |
| **Ganttチャート** | ✅ 完了 | SVGベース描画、バー編集、FS依存関係済み |
| **認証基盤** | ✅ 完了 | JWT認証、基本的なガード機能済み |
| **データベース** | ✅ 完了 | Prisma ORM、PostgreSQL、基本スキーマ済み |
| **監査ログ** | ✅ 完了 | ActivityLogモデル、基本記録機能済み |
| **カレンダー** | ✅ 完了 | 平日稼働、祝日設定、時間管理済み |

### 2.2 基本的スケジューリング機能の実装状況

**実装済み:**
- クリティカルパス計算（簡易版）
- 依存関係に基づく自動スケジューリング
- 前進パス・後退パス計算の基盤

**実装内容:**
- `GanttUtils.calculateCriticalPath()`: クリティカルパス特定
- `GanttUtils.traceCriticalPath()`: 逆方向パス追跡
- `autoScheduleTasks()`: 依存関係ベース自動スケジューリング

---

## 3. 未実装機能の詳細分析

### 3.1 高優先度未実装項目（Sprint 3対象）

#### A. プロジェクトパスワード保護機能
- **仕様書セクション**: §24 プロジェクト管理
- **実装状況**: 完全未実装
- **必要な実装**:
  - Projectモデル拡張: `visibility`, `password_hash`フィールド追加
  - API実装: `PUT /projects/:id/password`, `POST /projects/:id/access`
  - フロントエンド: パスワード入力モーダル、24時間トークン管理
  - セキュリティ: Argon2idハッシュ化、試行制限（5回/15分）

#### B. 性能最適化・テレメトリ
- **仕様書要件**: 初回描画<1.5s、ドラッグ応答<100ms
- **実装状況**: 基本的な性能制約のみ実装
- **必要な実装**:
  - KPI計測フック（初回描画、drag、zoom時間測定）
  - 仮想スクロール強化
  - 差分レンダリング最適化
  - Webワーカーでのスケジューリング処理

#### C. 進捗管理強化
- **実装状況**: 基本的な％表示のみ
- **必要な実装**:
  - Leafノードでの進捗直接編集
  - 親ノードへの自動集計強化
  - 工数ベース進捗計算

### 3.2 中優先度未実装項目（Sprint 4対象）

#### A. 高度なスケジューリング
- **仕様書セクション**: §15 スケジューリングアルゴリズム
- **実装状況**: 基本的なCPM計算は実装済み
- **必要な実装**:
  - ES/EF/LS/LF/TF計算の詳細化
  - ComputedScheduleマテリアライズドビュー
  - 期限超過・Blocked自動表示

#### B. エラーハンドリング・UX向上
- **実装状況**: 基本的なエラー処理のみ
- **必要な実装**:
  - 409競合時の巻き戻しトースト
  - 差分表示モーダル
  - 楽観的更新の強化

### 3.3 低優先度未実装項目（次期スプリント）

| 機能 | 仕様書セクション | 実装複雑度 | 備考 |
|------|----------------|-----------|------|
| **通知機能** | §8 | 高 | Slack/メール/In-App通知 |
| **Markdownサポート** | §25 | 中 | Issue説明のMD編集・プレビュー |
| **エクスポート機能** | §11 | 高 | Excel/PDF/PNG/CSV出力 |
| **バックアップ・復元** | §11 | 高 | ZIP形式、マッピング対応 |
| **RBAC詳細化** | §10 | 中 | 現在は基本JWT認証のみ |

---

## 4. 技術的制約・課題の分析

### 4.1 性能制約

#### 依存関係密度制限
- **現状**: Seedスクリプトで密度を0.3に制限
- **理由**: 大量データでのレンダリング性能確保
- **影響**: 複雑なプロジェクトでの依存関係表現に制限

#### 大規模データ処理
- **現状**: 1,000 Issue対応を目標
- **課題**: リアルタイム更新時の再描画コスト
- **対策**: 差分更新、仮想スクロール強化が必要

### 4.2 実装上の技術的課題

#### A. 未実装サービス連携
```typescript
// apps/api/src/issues/issues.service.ts:455
const dependencies = []; // TODO: Implement dependency fetching

// apps/api/src/issues/issues.service.ts:565  
assigneeName: undefined, // TODO: Fetch from user service
```

#### B. 検索・フィルタリング機能
```typescript  
// apps/web/src/components/wbs/WBSActions.tsx:43
// TODO: Implement search functionality

// apps/web/src/components/wbs/WBSActions.tsx:217
// TODO: Apply filters  
```

#### C. 基盤機能の不備
```typescript
// apps/api/src/app.service.ts:20
database: 'connected' // TODO: Add actual database health check
```

### 4.3 型定義・インターフェース一貫性

#### 状態管理の型安全性
- **現状**: Zustandによる型安全な状態管理実装済み
- **課題**: APIレスポンスとの型一貫性確保
- **対策**: 共通型定義ライブラリの活用

#### react-window型問題
- **現状**: TypeScript型エラーを`as any`でバイパス
- **影響**: 型安全性の低下
- **対策**: 適切な型定義の実装

---

## 5. 実装優先度マトリックス

### 優先度決定基準
1. **PoC受入基準への影響度**
2. **ユーザー体験への直接的影響**
3. **技術的実装コスト**
4. **既存実装との依存関係**

### 実装順序推奨

#### Phase 1 (Sprint 3) - 高優先度
1. **プロジェクトパスワード保護機能** (仕様書§24)
   - データベース拡張
   - API実装（認証・アクセス制御）
   - フロントエンドUI

2. **性能最適化・テレメトリ**
   - KPI計測実装
   - 初回描画・操作応答時間の測定・最適化

3. **進捗管理強化**
   - 直接編集機能
   - 自動集計ロジック改善

#### Phase 2 (Sprint 4) - 中優先度  
1. **高度なスケジューリング**
   - ComputedSchedule実装
   - 期限超過・Blocked表示

2. **エラーハンドリング強化**
   - 競合処理、差分表示
   - 楽観的更新改善

#### Phase 3 (次期) - 低優先度
1. **Markdownサポート** (§25)
2. **通知機能** (§8)
3. **エクスポート機能** (§11)

---

## 6. リスク分析・対策

### 高リスク項目

#### A. 性能要件未達
- **リスク**: 1,000 Issue環境での性能劣化
- **影響**: PoC受入基準未達成
- **対策**: 早期ベンチマーク実施、段階的最適化

#### B. プロジェクト管理複雑化
- **リスク**: パスワード保護実装による認証フロー複雑化  
- **影響**: UX低下、実装工数増大
- **対策**: 段階的実装、シンプルなUI設計

### 中リスク項目

#### C. 既存機能との統合問題
- **リスク**: 新機能が既存Gantt/WBS操作に干渉
- **影響**: 回帰バグ、ユーザビリティ低下
- **対策**: 包括的E2Eテスト、段階的ロールアウト

---

## 7. 技術的実装アプローチ

### 7.1 プロジェクトパスワード保護

#### データベース拡張
```sql
-- Migration required
ALTER TABLE "Project" ADD COLUMN "visibility" TEXT DEFAULT 'private';
ALTER TABLE "Project" ADD COLUMN "password_hash" TEXT;
```

#### セキュリティ実装
- Argon2idハッシュ化（メモリ16-64MB、time cost調整）
- 試行制限：Redis/メモリベース（IP+ブラウザ指紋で5回/15分）
- JWTトークン（24時間有効、project_access_token）

#### UI/UXフロー
```
プロジェクト選択 → パスワード入力モーダル → 認証成功 → 24時間閲覧権限付与
```

### 7.2 性能最適化

#### KPI計測フック実装
```typescript
// Performance metrics collection
interface GanttPerformanceMetrics {
  initialRenderTime: number;
  dragResponseTime: number; 
  zoomTransitionTime: number;
}
```

#### 最適化対象
1. **初回レンダリング**: SVG描画の差分更新
2. **ドラッグ操作**: イベント頻度制限、デバウンス
3. **データ取得**: キャッシュ戦略、部分読み込み

---

## 8. 次フェーズへの推奨事項

### 8.1 即座に着手すべき項目

#### 1. プロジェクトパスワード保護機能の実装
- **理由**: PoC評価における重要な差別化要素
- **工数**: 5-7人日（BE 3日 + FE 3日 + テスト 1日）
- **依存関係**: 認証基盤は実装済みのため、増分実装可能

#### 2. 性能テレメトリの導入
- **理由**: 受入基準（1.5s/100ms）の客観的測定
- **工数**: 2-3人日
- **効果**: 継続的な性能改善の基盤確保

### 8.2 計画フェーズ（PLAN）での検討事項

#### A. 実装スコープの確定
- Sprint 3の詳細仕様策定
- 受入基準の具体化
- 非機能要件の数値目標設定

#### B. 技術アーキテクチャ決定
- ComputedScheduleのデータ構造設計
- KPI収集・分析基盤の選定
- セキュリティ監査体制の構築

#### C. 開発体制・リソース計画
- 各実装項目の担当割り振り
- 外部依存関係（認証プロバイダー等）の調整
- テスト戦略・品質保証体制の確立

---

## 9. 結論・推奨アクション

### 調査結論
1. **基盤機能は十分**: Issue/WBS/Gantt基本機能は実用レベル
2. **Sprint 3項目が最優先**: パスワード保護・性能最適化が鍵
3. **技術的実装可能**: 既存アーキテクチャで十分対応可能
4. **リスク管理可能**: 段階的実装により品質確保可能

### 推奨実装戦略
1. **Sprint 3を即座に開始**: プロジェクトパスワード保護から着手
2. **性能測定基盤を先行実装**: 客観的評価環境の早期構築
3. **受入基準を数値化**: 明確な達成目標の設定

### PLANフェーズでの重点事項
- 詳細実装計画の策定
- 技術アーキテクチャの確定  
- 開発リソース・スケジュールの最適化

---

**Status**: COMPLETED  
**Next**: PLAN  
**Details**: "調査完了。docs/investigate/investigate_20250905_034851.mdに詳細を記述。実装方針策定を推奨。"